{# template pour l'objet ODButton #}

{% set typeBtn = "button" %}
{% switch(objet.type) %}
    {% case "submit" %}
        {% set typeBtn = "submit" %}
    {% case "reset" %}
        {% set typeBtn = "reset" %}
{% endswitch %}
{% set objClass = "gotObject "~gotBootstrap(objet.widthBT) %}
{% if objet.nature is not empty %}
    {%  set objClass = objet.nature ~ " " ~ objClass %}
{% endif %}
{# gestion des droits utilisateur }
{% if objet.allow is defined %}
    {% if objet.allow == 'DENIED' %}
        {%  set objClass = objClass ~ " disabled"  %}
    {% endif %}
{% endif %}
{ gestion des droits utilisateur #}
{% if objet.display is defined %} {# bouton mode affichage #}
    {%  set objClass = objClass ~ " display-" ~ objet.display ~ " " %}
{% endif %}
{% if objet.classes is not empty %} {% set objClass = objClass ~ " " ~ objet.classes %} {% endif %}

{% if objet.type == 'link' %}
    {% if objet.event.click is defined %}
        {% set route  = objet.event.click.class %}
        {% set params = objet.event.click.params %}
        {% if params is empty %}
            {% set routeUrl = ( url(route|lower) ) %}
        {% else %}
            {% set routeUrl = ( url(route|lower, params) ) %}
        {% endif %}
    {% endif %}
{% endif %}

<button id="{{ objet.id }}" data-objet="{{ objet.object }}" data-type="{{ objet.type }}"
        class="{{ objClass }}" type="{{ typeBtn }}"
        {% if objet.value is not empty %} value="{{ objet.value }}" {% endif %}

        {% if objet.infoBulle.title is not empty and objet.erreur.libel is empty %}
            {%  set infoBulle = objet.infoBulle %}
        {% elseif objet.erreur.libel is not empty %}
            {% set infoBulle = objet.infoBulle %}
            {% set erreur = objet.erreur %}
            {% set infoBulle = infoBulle | update({'title': erreur.libel, 'content': '', 'type': 'tooltip'}) %}
        {% endif %}
        {% if infoBulle is defined and infoBulle is not empty %}
            {% include 'graphic-object-templating/oobjects/infoBulle.twig'  with infoBulle %}
        {% endif %}

        {% if objet.event is not empty %}
            {% set allEvt = '' %}
            {% for evt, callback in objet.event %}
                {% set allEvt = allEvt ~ evt ~ ", " %}
                data-{{ evt }}-class ="{{ callback.class }}"
                data-{{ evt }}-method ="{{ callback.method }}"
                data-{{ evt }}-stopevt ="{{ callback.stopEvent }}"
            {% endfor %}
            data-evt="{{ allEvt | slice(0, allEvt|length - 2) }}"
        {% endif %}
        {% if objet.form is not empty %} data-form="{{ objet.form }}" {% endif %}
        {% switch objet.type %}
        {% case 'link' %}
        onclick="location.href='{{ routeUrl }}'"
        {% if params.target is defined and params.target is not empty %}
        {% endif %}
        {% case 'reset' %}
        onclick="javascript:razFormDatas('{{ objet.form }}');"
        {% endswitch %}
        {% if not objet.state %}
            disabled
        {% endif %}
>

    <style>
        {% if objet.style is not empty %}
        #{{ objet.id }} {
        {{ objet.style | raw }}
        }
        {% endif %}

        {% if objet.infoBulle.type is not empty and objet.infoBulle.css is not empty and objet.erreur.libel is empty %}
        {% set id = objet.id %}
        {% set type = objet.infoBulle.type %}
        {% set css = objet.infoBulle.css %}
        {% set placement = objet.infoBulle.placement %}
        {% include 'graphic-object-templating/oobjects/infoBulle.css.twig'  with {"id": id, "type": type, "css": css, "placement": placement } %}
        {% elseif objet.erreur.libel is not empty %}
        {% set erreur = objet.erreur %}
        {% set id = objet.id %}
        {% set type = 'tooltip' %}
        {% set css = "background-color: #" ~ erreur.backgroundColor ~ ";color: #" ~ erreur.color ~ ';' %}
        {% set placement = objet.infoBulle.placement %}
        {% include 'graphic-object-templating/oobjects/infoBulle.css.twig'  with {"id": id, "type": type, "css": css, "placement": placement } %}

        #{{ id }} {
            border:  solid 2px #{{ erreur.color }} !important;
        }
        {% endif %}
    </style>

    {% if objet.icon is not empty %}<i class="{{ objet.icon }}"></i>{% endif %}{{ translate(objet.label) }}

    <script id="{{ objet.id }}Script" type="text/javascript">
        $('document').ready(function () {
            {% switch true %}
            {% case (objet.type in  ['custom', 'submit', 'link'] and objet.event is empty) %}
            if (!$('#{{ objet.id }}').is(['disabled'])) $('#{{ objet.id }}').attr('disabled', 'disabled');
            {% case (objet.type =='reset' and objet.form is empty) %}
            if (!$('#{{ objet.id }}').is(['disabled'])) $('#{{ objet.id }}').attr('disabled', 'disabled');
            {% case objet.type != 'link' and objet.state == true %}
            {% if objet.event is not empty %}
            {% set events = objet.event %}
            {% include 'graphic-object-templating/oobjects/event.js.twig' with {'events': events, "object": 'odbutton', 'id':objet.id } %}
            {% endif %}
            {% endswitch %}
        });
    </script>

    {% if infoBulle.title is not empty %}
        {%  set type = infoBulle.type %}
        {%  set id = objet.id %}
        {% include 'graphic-object-templating/oobject/infoBulle.js.twig'  with {'id':id, 'type':type} %}
    {% endif %}
</button>

